# =============================================================================
# Journiv Configuration
# =============================================================================
# INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.template .env
# 2. Fill in all required values (marked with <REQUIRED>)
# 3. Review and adjust optional values
# 4. NEVER commit share .env to version control or share with others!

# =============================================================================
# Application Settings
# =============================================================================
APP_NAME="Journiv"
APP_VERSION="0.1.0-beta.4"
DEBUG=false
ENVIRONMENT=production  # Options: development, staging, production
# DOMAIN_NAME is required in production when running as same-origin SPA (ENABLE_CORS=false).
# Example: DOMAIN_NAME=journiv.myhomelab.com
DOMAIN_NAME=

# =============================================================================
# Security Settings (CRITICAL - MUST CONFIGURE FOR PRODUCTION)
# =============================================================================
# Generate a secure SECRET_KEY with one of these commands:
#   python -c "import secrets; print(secrets.token_urlsafe(32))"
# or
#   openssl rand -hex 32
#
# NEVER use the default value in production!
# This key is used for JWT tokens - compromising it compromises all user sessions
SECRET_KEY=

# JWT Token Configuration
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
ALGORITHM="HS256"

# CSP Configuration
ENABLE_CSP=true
ENABLE_HSTS=true
ENABLE_CSP_REPORTING=true
CSP_REPORT_URI="/api/v1/security/csp-report"

# =============================================================================
# CORS (Cross-Origin Resource Sharing) Configuration
# =============================================================================
# Journiv serves the Flutter Web SPA directly from FastAPI by default (same-origin mode),
# so keep ENABLE_CORS=false when the frontend and backend share the same origin.
# Set ENABLE_CORS=true when external clients (e.g. mobile apps) need to call the API.
ENABLE_CORS=false

# When ENABLE_CORS=true, provide the allowed origins (comma-separated).
# Example: CORS_ORIGINS=https://journiv.myhomelab.com,https://192.168.1.100:3000
# NEVER use * (wildcard) in production!
# Development helpers (if unset) default to localhost:3000,localhost:8080 when ENABLE_CORS=true.
CORS_ORIGINS=

# =============================================================================
# API Settings
# =============================================================================
API_V1_PREFIX="/api/v1"

# =============================================================================
# Database Configuration (CRITICAL - MUST CONFIGURE FOR PRODUCTION)
# =============================================================================
# SQLite connection string (default for self-hosted installs)
# For local development (relative path): sqlite:///./journiv.db
# For Docker deployment (absolute path): sqlite:////data/journiv.db
DATABASE_URL="sqlite:///./journiv.db"

# PostgreSQL example (optional, for multi-user deployments)
# DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Alternative: Set individual components (used in Docker)
POSTGRES_USER=journiv
POSTGRES_PASSWORD=  # MUST SET SECURE PASSWORD
POSTGRES_DB=journiv_prod
POSTGRES_HOST=db
POSTGRES_PORT=5432


# =============================================================================
# File Storage Configuration
# =============================================================================
# For local development (relative path): ./media
# For Docker deployment (absolute path): /data/media
MEDIA_ROOT="./media"
LOG_DIR="./logs"
MAX_FILE_SIZE_MB=50

# Allowed file types (comma-separated)
ALLOWED_MEDIA_TYPES="image/jpeg,image/png,image/gif,image/webp,video/mp4,video/avi,video/mov,video/webm,audio/mpeg,audio/wav,audio/ogg,audio/m4a,audio/aac"
ALLOWED_FILE_EXTENSIONS=".jpg,.jpeg,.png,.gif,.webp,.mp4,.avi,.mov,.webm,.mp3,.wav,.ogg,.m4a,.aac"

# =============================================================================
# API Configuration
# =============================================================================

API_V1_PREFIX=/api/v1

# Application port (for docker-compose)
APP_PORT=8000

# =============================================================================
# Logging Configuration
# =============================================================================
LOG_LEVEL="INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FILE=  # Leave empty to log to stdout (recommended for Docker)

# =============================================================================
# OIDC (OpenID Connect) Authentication Configuration
# =============================================================================
# Enable OIDC authentication (e.g., Pocket ID, Keycloak, Auth0)
OIDC_ENABLED=false

# OIDC provider issuer URL (must be HTTPS in production)
# Example: https://auth.example.com or https://localhost:1411 (for Pocket ID dev)
OIDC_ISSUER=https://pocketid.example.com

# OAuth2 client credentials (register your app with the OIDC provider)
OIDC_CLIENT_ID=Journiv
OIDC_CLIENT_SECRET=your-super-secret-client-secret

# Redirect URI where OIDC provider sends the user after authentication
# Must be registered in your OIDC provider's allowed redirect URIs
OIDC_REDIRECT_URI=https://${DOMAIN_NAME}:${APP_PORT}/api/v1/auth/oidc/callback

# OAuth2 scopes to request (space-separated)
OIDC_SCOPES="openid email profile"

# Auto-provision new users from OIDC (create account on first login)
# Set to false to require manual user registration before OIDC login
OIDC_AUTO_PROVISION=true

# DEVELOPMENT ONLY: Disable SSL verification for self-signed certificates
# Set to true to override for local domains (e.g., .local hostnames)
# NEVER set to true in production! Always use valid SSL certificates.
OIDC_DISABLE_SSL_VERIFY=false

# =============================================================================
# Redis Configuration (Optional - for OIDC state management)
# =============================================================================
# Redis URL for OIDC state/session storage (recommended for production)
# Falls back to in-memory cache if not set (single-worker only)
# Example: redis://localhost:6379/0
# Note: This feature is not tested and is currently WIP. Only use it if you know
# what you are doing.
REDIS_URL=

# =============================================================================
# Rate Limiting Configuration
# =============================================================================

# Enable/disable rate limiting (set to false for local testing)
RATE_LIMITING_ENABLED=true

# Storage backend for rate limiting counters.
# Use redis://<host>:<port> in production for multi-worker support.
RATE_LIMIT_STORAGE_URI=memory://

# Default rate limits applied when an endpoint does not have a specific override.
# Comma-separated list (e.g. 100/minute,1000/hour). Leave blank to use built-in defaults.
RATE_LIMIT_DEFAULT_LIMITS=

# Optional JSON object that overrides individual endpoint limits.
# Example:
# RATE_LIMIT_CONFIG={"auth":{"login":"5/minute","register":"3/minute"}}
RATE_LIMIT_CONFIG=
