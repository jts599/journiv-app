{
  "$schema": "https://raw.githubusercontent.com/devcontainers/spec/main/schemas/devContainer.schema.json",
  "name": "Journiv Development (PostgreSQL)",
  "dockerComposeFile": "../docker-compose.dev.yml",
  "service": "app-postgres",
  "workspaceFolder": "/app",
  
  // Run both postgres and app-postgres services
  "runServices": ["postgres", "app-postgres"],
  
  // Configure what happens when the container is created
  "onCreateCommand": "pip install --no-cache-dir -r requirements/dev.txt",
  
  // Post-start command to ensure directories exist
  "postStartCommand": "mkdir -p /data/media /data/logs",
  
  // VS Code customizations
  "customizations": {
    "vscode": {
      // Extensions to install
      "extensions": [
        // Python development
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.debugpy",
        
        // Code formatting and linting
        "ms-python.black-formatter",
        "ms-python.isort",
        "ms-python.flake8",
        
        // Docker support
        "ms-azuretools.vscode-docker",
        
        // Database tools
        "mtxr.sqltools",
        "mtxr.sqltools-driver-sqlite",
        "mtxr.sqltools-driver-pg",
        
        // Git tools
        "eamodio.gitlens",
        
        // YAML support
        "redhat.vscode-yaml",
        
        // Environment file support
        "mikestead.dotenv",
        
        // General productivity
        "aaron-bond.better-comments",
        "usernamehw.errorlens",
        "streetsidesoftware.code-spell-checker"
      ],
      
      // Settings
      "settings": {
        // Python configuration
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "python.linting.enabled": true,
        "python.linting.pylintEnabled": false,
        "python.linting.flake8Enabled": true,
        "python.formatting.provider": "none",
        "python.analysis.typeCheckingMode": "basic",
        "python.analysis.autoImportCompletions": true,
        "python.testing.pytestEnabled": true,
        "python.testing.unittestEnabled": false,
        "python.testing.pytestArgs": [
          "."
        ],
        
        // Black formatter
        "[python]": {
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.organizeImports": "explicit"
          }
        },
        "black-formatter.args": [
          "--line-length=88"
        ],
        "isort.args": [
          "--profile", "black"
        ],
        
        // Editor settings
        "editor.rulers": [88],
        "editor.tabSize": 4,
        "editor.insertSpaces": true,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,
        
        // File associations
        "files.associations": {
          "*.env*": "dotenv",
          "docker-compose*.yml": "yaml",
          "Dockerfile*": "dockerfile"
        },
        
        // SQLTools configuration for PostgreSQL
        "sqltools.connections": [
          {
            "name": "Journiv PostgreSQL (Dev)",
            "driver": "PostgreSQL",
            "server": "postgres",
            "port": 5432,
            "database": "journiv_dev",
            "username": "journiv",
            "password": "journiv_password",
            "previewLimit": 50
          }
        ],
        
        // Terminal
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.cwd": "/app"
      }
    }
  },
  
  // Forward ports for the application and database
  "forwardPorts": [8000, 5432],
  "portsAttributes": {
    "8000": {
      "label": "Journiv API",
      "onAutoForward": "notify"
    },
    "5432": {
      "label": "PostgreSQL",
      "onAutoForward": "silent"
    }
  },
  
  // Container user
  "remoteUser": "appuser",
  
  // Container environment variables
  "containerEnv": {
    "PYTHONPATH": "/app",
    "ENVIRONMENT": "development",
    "DEBUG": "true"
  },
  
  // Mount the Docker socket for Docker-in-Docker support (optional)
  "mounts": [
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ]
}
